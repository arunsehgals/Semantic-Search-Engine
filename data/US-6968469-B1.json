eady resides in the external memory (DRAM). The CPU then completes the boot-up procedure by restoring the device states, and, with a special instruction, finally restores the CPU context from the external memory. Thereafter, the CPU is able to simply proceed with executing the next application program instruction exactly where the CPU left off when entering STR.</p><p num=\"p-0011\">In a stage of sleep mode that lies one stage above the STR stage, the penultimate stage (e.g. the pre-STR stage) referred to as \u201cdeep sleep\u201d, existing operating systems issue an instruction to remove the system clock from the CPU, but to maintain the CPU powered up, continuing to consume battery power. The removal of the system clock reduces power consumption also, but that is not as great a reduction as when power is removed from the CPU, such as during STR. Without clock signals being applied, the CPU is no longer able to process (as would consume additional current), but maintains system context in the associated internal registers of the CPU. That context is not lost and is not required to be saved to external memory as is the case in entering the STR stage. As an advantage, the invention powers down the CPU in all sleep modes and preserves the CPU context, saving additional power.</p><p num=\"p-0012\">Accordingly, an object of the invention is to reduce the power consumption of a computer during periods in which the computer is idle, providing a more effective sleep mode.</p><p num=\"p-0013\">Another object of the invention is to promote the pre-STR stage of sleep mode in existing power management systems to the STR stage, creating an \u201cInstant STR\u201d, and reduce the time required by the computer system to return from that stage, ideally providing a Resume from STR that appears instantaneous.</p><p num=\"p-0014\">And, a related object of the invention is to replace on-the-fly a CPU context maintaining sleep mode of existing computer systems that is governed by the operating system with a substitute sleep mode that affords a lower power consumption and remains transparent to the software.</p><h4>SUMMARY OF THE INVENTION</h4><p num=\"p-0015\">In accordance with the foregoing objects and advantages, the present invention provides for saving the internal context of the CPU (which includes the state of the application software) and powering down the CPU not only for an STR condition but for any pre-STR stage of sleep mode, and for restoring the state, including such internal context, on the Resume from STR condition, whereby the processor system is quickly restored for operation ready to execute the next instruction of the application program. With the invention, any stage of sleep mode can be promoted to an STR condition to completely power down the CPU in a manner that is transparent to the operating system.</p><p num=\"p-0016\">When applied to directly to existing X86 applications and operating systems, the present invention intercepts (or converts) an instruction that calls for an X86 type computer system to enter a CPU context-maintaining sleep mode, a pre-STR stage of sleep mode, and \u201cpromotes\u201d or converts that instruction into an instruction to enter the STR stage, and thereafter perform all of the actions described for entering STR. Whereas the X86 operating system of the CPU may \u201cthink\u201d that the context of the application program has been saved in one way, the present system actually saves that program context and the CPU context in a different manner, transparent to the X86 operating system. When Resuming from STR, the context is restored, and the X86 operating system is none the wiser.</p><p num=\"p-0017\">In accordance with a more specific aspect, the present invention provides a private memory within the processor system, a memory external to the CPU, that is accessible only to the CPU and is powered independently of the CPU to store the CPU context when the CPU is powered down in a sleep mode. The private memory may constitute a logical portion of the external memory, DRAM, in the X86 system, or may be physically separate therefrom or may constitute a logical partition of the CPU internal memory, such as a cache or subset of such cache. Like the existing DRAM, a key characteristic of the foregoing memory is that such memory is independently powered from the CPU core. In the Transmeta processing system, hereafter noted, that memory may be commandeered to serve as private memory for code morphing software (e.g. \u201cCMS memory\u201d). The power down routine for sleep mode includes reading the internal CPU context from the internal memory of the CPU, caches and registers, and writing that context within the private memory. When powered up, either initially or on return from STR, the processor determines whether to perform a normal power up operation, called a power on reset, or a context-restoring operation.</p><p num=\"p-0018\">On entering into the Instant STR condition, before concomitant powering down of the CPU of the computer, the CPU preserves the entire CPU context in the independently powered private external memory of the CPU. So long as the private memory remains powered up, the CPU context is preserved despite the fact that the CPU is powered down. Upon Resume from Instant STR to resume processing, power is restored to the CPU. During the boot-up process, the CPU detects that the condition is a resume from Instant STR and, in response, restores its entire internal state from the preserved CPU context located in the private memory. Thereafter the CPU may perform an internal resume to the instruction of the application program that follows the last completed instruction of that program.</p><p num=\"p-0019\">As an advantage, the CPU is able to automatically and transparently recover from a sleep mode that powers down the CPU and continue execution of any arbitrary computer program after lapses of arbitrary duration in the sleep mode without any assistance being required of the operating system, BIOS or the like.</p><p num=\"p-0020\">The present invention is particularly adaptable to incorporation within and enhances a newly disclosed processor system that is found to already contain a private memory that is powered separately from the processor, but is used to store, among other things, only a part of the internal context of the CPU. That processor system is the very long instruction word (VLIW) processor described, for one, in U.S. Pat. No. 6,031,992, granted Feb. 29, 2000, entitled Combining Hardware and Software to provide an Improved Microprocessor, assigned to Transmeta Corporation, (referred to as the 992 Transmeta patent), which is incorporated herein by reference.</p><p num=\"p-0021\">The processor of the 992 Transmeta patent is formed by a combination of a hardware processing portion (called a \u201cmorph host\u201d), and an emulating software portion, referred to therein as code morphing software. Among other things, the code morphing software carries out a significant portion of the functions of processors in software, reducing the hardware required for processing and the greater electrical power that such hardware requires. The Transmeta processor serves as the host processor system capable of executing software programs (the \u201ctarget application\u201d) designed with an instruction set intended to run on a processor system of different design, the target processor, one that contains an instruction set unique to the target processor, but foreign to the host system, such as the X86 type processor.</p><p num=\"p-0022\">That processor translates instructions that comprise a target software program \u201con-the-fly\u201d into instructions of the host instruction set (the host instructions); and then executes the latter instructions. In so doing, the morph host processor executes the code morphing software which, functioning as either a software \u201cinterpreter\u201d or \u201ctranslator\u201d of target application programs into host processor instructions, which are able to accomplish the purpose of the original application software. For translation, the code morphing software defines a translator, which converts the target instructions to host instructions, and a translation process that translates the target application programs dynamically and optimizes the latter host instructions to provide an optimized translation.</p><p num=\"p-0023\">The foregoing Transmeta processing system, hereafter referred to as the Transmeta processor, necessarily keeps track of its state or CPU context during processing operation. It is found that the Transmeta processor places a considerable portion of its CPU context on memory external of the CPU, such as DRAM. Conceptually, that external memory is herein referred to as \u201cprivate\u201d CPU memory, because that memory is not visible to (and cannot be accessed by) external application programs; and only the code morphing software of the CPU is able to access the private memory. Further the CPU private memory resides in a different power domain than the CPU, and, therefore, may be powered up or down independently of the CPU. Consequently, the private memory is able to maintain a portion of the internal state of the CPU when the CPU is powered down.</p><p num=\"p-0024\">Other portions of the CPU context are saved in memory (caches) internal to the CPU, apart from the private memory. Normally that portion of the CPU context (information) would disappear whenever the Transmeta processor is powered down. In accordance with the present invention, the entire CPU context of the Transmeta processor is stored in the private memory in the Instant STR process. Accordingly, a further object of the invention is to provide a portable computer constructed in accordance with the Transmeta processing system with an improved power saving sleep mode.</p><p num=\"p-0025\">When powered up, either initially or on return from Instant STR, the processor determines whether it is to perform a normal power up operation (a power on reset) or a context-restoring operation. Traditional processors typically employ external circuitry to make that decision. The Transmeta processor deposits the corresponding persistent information in the private memory. The presence of that information in the private memory is called an \u201cSTR signature\u201d.</p><p num=\"p-0026\">As an advantage, the Transmeta CPU is able to automatically and transparently recover from a sleep mode in which the CPU is powered down and continue execution of any arbitrary application program, including target applications, after time lapses of arbitrary duration in the sleep mode without any assistance required of the application program. Upon resume from such a sleep mode, the Transmeta processor is able to continue with execution of a target application program. The Transmeta processor is capable of suspending arbitrary X86 computer programs to private memory (e.g. CMS memory) and automatically and transparently resume executing the next instruction of the program without any assistance of the target application.</p><p num=\"p-0027\">The foregoing and additional objects and advantages of the invention together with the structure characteristic thereof, which was only briefly summarized in the foregoing passages, will become more apparent to those skilled in the art upon reading the detailed description of a preferred embodiment of the invention, which follows in this specification, taken together with the illustrations thereof presented in the accompanying drawings.</p><?BRFSUM description=\"Brief Summary\" end=\"tail\"?><?brief-description-of-drawings description=\"Brief Description of Drawings\" end=\"lead\"?><description-of-drawings><h4>BRIEF DESCRIPTION OF THE DRAWINGS</h4><p num=\"p-0028\">In the drawings:</p><p num=\"p-0029\"><figref idrefs=\"DRAWINGS\">FIG. 1</figref> is a high-level block diagram of one embodiment of a digital processor which incorporates the invention.</p><p num=\"p-0030\"><figref idrefs=\"DRAWINGS\">FIG. 2</figref> is a flow chart defining the operation of the processor of <figref idrefs=\"DRAWINGS\">FIG. 1</figref>.</p><p num=\"p-0031\"><figref idrefs=\"DRAWINGS\">FIG. 3</figref> is a high-level block diagram of another embodiment of a digital processor which incorporates the invention.</p></description-of-drawings><?brief-description-of-drawings description=\"Brief Description of Drawings\" end=\"tail\"?><?DETDESC description=\"Detailed Description\" end=\"lead\"?><h4>DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENTS</h4><p num=\"p-0032\">The invention is preferably implemented within the improved 992 Transmeta processor system earlier described, which implements software-enhanced execution (eg. dynamic translation), and is best explained in connection with that processor. The principal elements of that processing system as modified to incorporate the invention are symbolically illustrated in <figref idrefs=\"DRAWINGS\">FIG. 1</figref>, to which reference is made. The processing system contains a computer processing unit (\u201cCPU\u201d) <b>1</b>, a memory <b>3</b> for the X86 program, the target machine code that the processor is to translate, its data, and a memory <b>5</b> with the private runtime support for the computer, the latter memory herein referred to as private memory. Memory <b>3</b> may encompass the entire memory hierarchy, including disk, RAM, 2<sup>nd </sup>level cache and 1<sup>st </sup>level cache. ROM memory, which is used by the processor, is considered as being separate from the processor, and for purposes of this description is not considered as part of the memory hierarchy of the processor. The foregoing illustration also excludes the memory that is regarded as internal to the CPU (\u201cinternal\u201d memory).</p><p num=\"p-0033\">The foregoing architecture is recognized as different from the traditional processor systems, such as the X86 system, which does not contain memory <b>5</b>. As represented by the power arrows P<b>1</b>, the private memory <b>5</b> resides in a separate power domain than CPU <b>1</b> (and memory <b>3</b>). Hence, electrical power to each component of the system may be separately and independently controlled, more specifically, CPU <b>1</b> may be powered down, while private memory <b>5</b> remains powered.</p><p num=\"p-0034\">During processing operation, the Transmeta CPU <b>1</b> keeps track of its state or context. Since the Transmeta computer \u201cvirtualizes\u201d the target processor, such as the X86 processor system, the computer must also keep track of the state of the X86 processor system, possibly including part of the chipset and the target (X86) application program for that processor, which is being translated and executed by the code morphing software. Hence, the context of the Transmeta processor constitutes a super-set of and subsumes the state of the X86 processor system.</p><p num=\"p-0035\">The context of the Transmeta processing system is reflected in the contents of the general purpose registers, including core special registers (\u201cCSR's\u201d), peripheral special registers (\u201cPSR's\u201d), and the Northbridge registers, the D-cache, the I-cache, local program memory (\u201cLPM\u201d), and local data memory (\u201cLDM\u201d). Some of that context is stored in private memory <b>5</b>. However, the internal context of CPU <b>1</b> is stored in internal memory, represented in the dotted block <b>6</b> within CPU <b>1</b>.</p><p num=\"p-0036\">The Transmeta computer includes a start up procedure to initialize and configure (\u201cset up\u201d) the computer and begin processing, a procedure defined by software or in firmware, such as ROM code, which is included. That start-up procedure (\u201cboot-up\u201d) is initiated once power to the computer is switched on to apply power (P<b>1</b>, P<b>2</b>, and P<b>3</b>) to both the CPU <b>1</b> and memories <b>3</b> and <b>5</b>, a \u201cboot-up\u201d procedure referred to as \u201cpower-on reset\u201d.</p><p num=\"p-0037\">The processor commences the start up procedure, as represented by operation <b>11</b> in <figref idrefs=\"DRAWINGS\">FIG. 2</figref> to which reference is made. Both the code morphing software and the CMS boot loader software of the Transmeta processing system are stored in compressed form in flash ROM (not illustrated) of the computer.</p><p num=\"p-0038\">The CPU locates the CMS boot loader routine in the flash ROM and installs that routine in internal memory <b>6</b>, as represented at block <b>13</b>. As represented by operation <b>15</b>, the CMS boot loader continues with configuring the cache, the private memory <b>5</b>, and, possibly, the other memory.</p><p num=\"p-0039\">At this juncture, and in accordance with the invention, the boot loader looks for an \u201cSTR signature\u201d, operation <b>19</b>, which is later described herein in greater detail in connection with a Resume from STR condition. However, since the initial power on reset of the computer is presently being described, the STR signature is not present, and the decision at decisional block <b>21</b> is negative. A discussion of the operation that occurs when the STR signature is found is reserved to a later point in this description. The normal power on reset process continues, represented at operation <b>23</b>, with the boot loader program requiring CPU <b>1</b> to locate the compressed CMS in the flash ROM, decompress the CMS and load that software in the private memory <b>5</b> where stored for use in processing. Depending upon the design of the computer, the program may also set up a debugging environment for the processor, prior to decompressing the code morphing software.</p><p num=\"p-0040\">Once stored in private memory <b>5</b>, the boot loader routine \u201cjumps\u201d into the code morphing software at its \u201creset\u201d vector in private memory <b>5</b>, as represented at block <b>25</b> and begins executing (e.g. starts) the CMS. On starting, the CMS resets the CPU registers and establishes the CPU context, as represented by block <b>27</b>A, configures other memory, block <b>27</b>B, and then commences normal processing, the details of which are not relevant or material to the present invention.</p><p num=\"p-0041\">Continuing with right side of <figref idrefs=\"DRAWINGS\">FIG. 2</figref>, during normal processor operation, which in accordance with the present invention includes the sleep mode, the power management sub-routine of the BIOS or operating system periodically checks for activity on the processor keyboard and other user input devices, and, as represented by block <b>10</b>, checks to determine if instructions of an application program are being executed by the processor. The routine also records and stores the time of the last such activity and compares that time to the time of the present check to determine if the interval is greater than a predetermined time, Tmax, represented by decisional block <b>12</b>. If not, the determination is negative and normal processing activity of the processor continues, as represented at block <b>14</b>, including periodically repeating the activity check operation indicated by the dotted line to block <b>10</b>.</p><p num=\"p-0042\">Should the period of inactivity continue until the comparison determination results in an interval of greater than Tmax, a flag is set, represented by an affirmative decision at block <b>12</b>. On finding that flag, the CPU program branches from the main routine to retrieve and execute the Instant STR routine, as represented at block <b>16</b>.</p><p num=\"p-0043\">An initial step in the Instant STR routine is to retrieve the part of the CPU context and Northbridge registers that is stored in the CPU's internal memory, and save that context in private memory <b>5</b>. As represented at block <b>18</b>, the foregoing state information is stored in the private memory along with the normal X86 execution state information, which the Transmeta processor normally saves in that memory.</p><p num=\"p-0044\">Thereafter, the processor initiates the chipset to shut down power to CPU <b>1</b> (and other components of the processor), excepting the private memory <b>5</b>, after a defined short time interval and sets the STR signature, as represented by operation <b>20</b>. The chipset withdraws the power P<b>1</b> to the CPU, which ceases operation at this point. Any information in the internal memories of the CPU disappears. Since private memory <b>5</b> remains powered up, that is, P<b>2</b> (<figref idrefs=\"DRAWINGS\">FIG. 1</figref>) continues, the entire context information is preserved. At this stage the CMS of the Transmeta processor is retained private memory <b>5</b>.</p><p num=\"p-0045\">While shutting down (i.e. before removing the power), CMS detects the Instant STR event and sets a corresponding flag (e.g. the \u201cSTR signature\u201d) in non-volatile memory. This enables the code morphing software to detect the Instant STR condition upon a power-on-reset, as later herein described. The foregoing flag may be implemented by writing the STR signature into private memory <b>5</b>. Concurrently additional hardware, such as the Southbridge chip, serves to monitor the user input device <b>7</b> (<figref idrefs=\"DRAWINGS\">FIG. 1</figref>) represented at block <b>24</b>. If a negative determination is made, the checking continues as indicated at decisional block <b>26</b>. If, however, any user activity is detected, such as the user's manipulation of any user input device <b>7</b>, such as keyboard or mouse or the like, then an affirmative determination is made at decisional operation <b>26</b> and the computer initiates the operation, represented at block <b>28</b> to restore power to the CPU and execute the power up sequence. The latter operation returns the flow to operational block <b>11</b>, which was earlier described.</p><p num=\"p-0046\">The sequence of operation proceeds through the operations represented by operational blocks <b>13</b>, <b>15</b> and <b>19</b>, earlier described and not here repeated. When the boot loader checks for an STR signature this time as represented at block <b>19</b>, an affirmative determination is made at decisional block <b>21</b>. The processor clears the STR signature, 30, skips decompressing CMS as the software resides in the private memory, and, as represented in block <b>32</b> directly jumps into the CMS \u201cresume from STR\u201d routine vector in private memory <b>5</b>. The CMS commences by restoring the internal CPU context and Northbridge registers from the private memory into the appropriate registers of the CPU as represented at operation <b>34</b> and configures other memory <b>36</b>. With internal CPU context restored, all memories configured, and program state present in the private memory, the processor is restored to the state existing at the time of initiation of the sleep mode procedure at which juncture the processor may then retrieve the next instruction of the X86 target application for execution, as represented at block <b>38</b>. As one appreciates, the foregoing method completes rapidly.</p><p num=\"p-0047\">An alternative embodiment of the sleep mode invention would employ faster memory still, but would require modification to the structure of the Transmeta computer. Specifically, where it is practicable to modify the integrated circuit chip that contains the processor of the Transmeta computer so as to permit the on-chip caches to be powered up or down separately from the remaining elements of the processor, then it is possible to retain the internal context of the CPU within the processor during the sleep mode, avoiding the necessity for transferring the internal context to the private memory and back again during resume from the Instant STR procedure. Such a configuration is illustrated in <figref idrefs=\"DRAWINGS\">FIG. 3</figref>, in which the internal memory and cache <b>8</b> are powered by power domain P<b>4</b>, separate from the power domain P<b>1</b> of the other CPU elements. In as much as the memory employed for cache application is typically the fastest memory available, and the location is physically closer to the principal elements of the processor, propagation time is reduced. Further, the processing time to transfer the information is eliminated. In this embodiment, the memory serves both the function of cache and of the private memory found in the initial embodiment, earlier described.</p><p num=\"p-0048\">The foregoing invention may be incorporated within target processing systems that currently employ a sleep mode, such as the X86 system, but requires some modification to the target system's operating software. Since a memory of the X86 system is already powered separately from the CPU of the processing system and for sleep mode operation that memory is already used to store the state of the operating system and the application program, an extra portion of that external memory may be used to also store the internal context of the X86 CPU.</p><p num=\"p-0049\">Assume two levels of \u201csleep\u201d for the X86 type computer: A first level in which the central processing unit (CPU) of the processor maintains the CPU context and a second level, more deep than the first, in which the context of the CPU is not maintained. In the first level, the Southbridge circuit of the processor shuts off (sic \u201ckills\u201d) the input clocks to the CPU, but maintains power to the CPU. The BIOS and operating system (\u201cOS\u201d) of the computer typically uses the first level or state a good deal of the time, because the state is low-overhead. In the second level, the Southbridge circuit kills the CPU input clocks, as before, and then also removes electrical power to the CPU and other devices of the processor. As a result of the removal of electrical power, the context information of the CPU state is lost. The BIOS and OS of the computer uses this second state less frequently than the first because the state is high overhead.</p><p num=\"p-0050\">The present invention permits transparent power cycling of the CPU, turning the CPU off and then turning the CPU on, repeatedly at will, with low overhead (e.g. virtually maintaining the CPU context). Two embodiments of the invention are thus possible. The invention may replace the STR process found in the X86 processor system. In such an embodiment, the resume process restores the processor more quickly than the existing STR procedure although no savings is made in power consumption.</p><p num=\"p-0051\">In a preferred embodiment, the invention replaces the CPU context-maintaining sleep state of the X86 system (e.g. \u201cdeep sleep\u201d which is the deepest CPU context maintaining sleep mode) and the invention \u201ctricks\u201d the BIOS and/or OS to \u201cthink\u201d that the CPU is placed in the sleep mode, deep sleep, when, in fact, once the BIOS and OS initiates the \u201cdeep sleep\u201d action, all electrical power is removed from the CPU and the CPU enters the Instant STR condition. The advantage is that less power is consumed over time than when the CPU is placed in sleep mode. And with the benefit of the very rapid resume from STR action available with the invention the computer user never knows that the CPU had been turned off.</p><p num=\"p-0052\">The foregoing second embodiment is possible of accomplishment in two different species. In the first specie of the preferred embodiment the code morphing software of the Transmeta processor intercepts the command issued by the operating system, such as Windows 9X, to shut down the CPU clock input to the CPU. Then the code morphing software issues a command to power down the CPU completely, that is, disable the CPU clock input and also remove electrical power from the CPU. Thus while the operating system \u201cthinks\u201d that the CPU remains powered, in fact, the CPU is completely powered down. In that sense the action is transparent to the X86 OS software and to the BIOS. In existing computers the context of the CPU is lost in this power saving mode. In the present invention the CPU context is saved in private memory <b>5</b>.</p><p num=\"p-0053\">The second species of the preferred embodiment requires the BIOS and/or the OS software to be modified to explicitly invoke an Instant STR operation. It may not be possible to accomplish this in computers that use a \u201cclosed\u201d operating system, such as WINDOWS 9X, that can only be modified by the copyright owner, but can be readily accomplished in \u201copen\u201d operating systems, such as the familiar LINUX operating system. In new generations of BIOS and OS software, such a command may be easily incorporated, if timely suggested to the designers of such software.</p><p num=\"p-0054\">By powering down the CPU additional power savings may be achieved when the computer is left idle. In the case of present CPU's operating at 600 MHz, the power saving is about sixty milliwatts. That savings would increase for computers in the future that contain future versions of CPU's containing process technology advances that typically allow higher operating frequencies, but result in greater power consumption in sleep mode.</p><p num=\"p-0055\">It is believed that the foregoing description of the preferred embodiments of the invention is sufficient in detail to enable one skilled in the art to make and use the invention. However, it is expressly understood that the detail of the elements presented for the foregoing purpose is not intended to limit the scope of the invention, in as much as equivalents to those elements an